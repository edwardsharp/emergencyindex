<% if @projects.blank? %>
  <p class="center"><i>No projects found!</i></p>
<% else %>
  <table class="highlight responsive-table">
    <thead>
      <tr>
        <% if user_signed_in? and current_user.admin? %>
        <th class="ellipsis maxwidth">Submitted</th>
        <th class="ellipsis maxwidth">Published</th>
        <% end %>
        <th class="ellipsis maxwidth">Volume</th>
        <th class="ellipsis">Name</th>
        <th class="ellipsis">Title</th>
        <th class="ellipsis">First date</th>
        <th class="ellipsis">Venue</th>
        <th class="ellipsis">Home</th>
        <th class="ellipsis">Image</th>
        <th colspan="3"></th>
      </tr>
    </thead>

    <tbody>
      <% @projects.each do |project| %>
        <tr onclick="projectRowClick(this,'<%= url_for project %>')">
          <% if user_signed_in? and current_user.admin? %>
          <td class="ellipsis maxwidth"><%= l project.created_at, format: :short %></td>
          <td class="ellipsis maxwidth"><%= project.published %></td>
          <% end %>
          <td class="maxwidth"><%= project.volume.year %>
          <td class="ellipsis minwidth"><%= project.name %></td>
          <td class="ellipsis minwidth"><%= project.title %></td>
          <td class="ellipsis"><%= project.first_date %></td>
          <td class="ellipsis"><%= project.venue %></td>
          <td class="ellipsis"><%= project.home %></td>
          <td class="ellipsis"><%= image_tag project.attachment.url(:thumb) if project.attachment.present? %></td>
          <td><%= link_to '<i class="material-icons prefix tooltipped" data-tooltip="Permalink">link</i>'.html_safe, project, class: 'btn btn-flat btn-icon waves-effect' %></td>
          <% if user_signed_in? %>
          <td><%= link_to '<i class="material-icons prefix tooltipped" data-tooltip="Edit">edit</i>'.html_safe, edit_project_path(project), onclick: 'event.cancelBubble=true', class: 'btn btn-flat btn-icon waves-effect' if current_user.admin? or current_user.id == project.user_id %></td>
          <td><%= link_to '<i class="material-icons prefix tooltipped" data-tooltip="Delete">delete_forever</i>'.html_safe, project, onclick: 'event.cancelBubble=true', method: :delete, data: { confirm: 'Are you sure?' }, class: 'delete-project btn btn-flat btn-icon waves-effect', 'data-project-id': project.id if current_user.admin? or current_user.id == project.user_id %></td>
          <% end %>
        </tr>
      <% end %>
    </tbody>
  </table>
<% end %>
<% if current_user.admin? or current_user.id == project.user_id %>
<script type="text/javascript">
$( function() {
  $('.delete-project').click(function(e){
    e.preventDefault();
    //e.stopPropagation();
    if(confirm("Are you sure?")){
      $.ajax({
        url: "/admin/delete_project",
        method: "DELETE",
        data: { project: { id : $(this).data('project-id') } },
        success: function(){
           Materialize.toast('Project deleted!', 5000)
        }
      });
    }
    else{
      return false;
    }
  });
});
</script>
<% end %>
