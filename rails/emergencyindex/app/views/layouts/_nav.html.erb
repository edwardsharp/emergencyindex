<style type="text/css">
  #nav {
    top: 0;
    max-height: 100px;
  }
  #user-nav{
    display: flex;
    align-items: center;
    justify-content: space-around;
  }
  #user-nav a{
    padding-right: 5px;
    padding-left: 5px;
  }
  a.username{
    min-width: 50%;
    max-width: 85%;
    overflow: hidden;
    white-space: nowrap;
    text-overflow: ellipsis;
    text-align: center;
  }
  .nav-heading{
    width: 100%;
    text-align: right;
    padding-right: 2em;
  }
  .nav-item{
    padding: 0 32px;
    font-weight: bold;
  }
  .logout i{
    margin-top: 16px;
  }
</style>

<div id="nav" class="fixed-action-btn click-to-toggle">
  <a href="#" data-activates="slide-out" class="button-collapse btn-floating btn-large tooltipped" data-delay="250", data-tooltip="Show Menu"><i class="material-icons medium">radio_button_checked</i></a>
</div>

<ul id="slide-out" class="side-nav<%= ' fixed' if controller_name == 'home' or (controller_name == 'projects' and action_name == 'index') or (controller_name == 'indexes' and action_name != 'index') or controller_name == 'volumes' %>">
  <div class="sticky-nav">
    <li>
      <div id="user-nav">
      <% if user_signed_in? %>
        <!-- <div class="background">
          <img src="">
        </div> -->
        <!-- <a href="#!user"><img class="circle" src=""></a> -->
        <%= link_to edit_user_registration_path, class: 'waves-effect waves-light tooltipped username', 'data-tooltip': 'Edit Registration' do %>
          <%= current_user.name %>
          <% if current_user.admin? %>
            <i class="material-icons tiny">verified_user</i>
          <% end %>
        <% end %>
        <%= link_to('<i class="material-icons">power_settings_new</i>'.html_safe, destroy_user_session_path, method: :delete, class: 'waves-effect tooltipped logout', 'data-tooltip': 'Log out') %>
      <% else %>
        <%= link_to('Login', new_user_session_path, class: 'waves-effect') %>
        <%= link_to('Register', new_user_registration_path, class: 'waves-effect')  %>
      <% end %>
      </div>
    </li>
    <% if user_signed_in? and current_user.admin? %>
      <li><div class="divider"></div></li>
      <li>
        <% if controller_name == 'admin' %>
          <span class="nav-item">Admin</span>
        <% else %>
          <a href="/admin" class="waves-effect">Admin</a>
        <% end %>
      </li>

    <% end %>

    <li><div class="divider"></div></li>

    <li><a href="/indexes" class="waves-effect">Indexes</a></li>

    <% if user_signed_in? %>
      <li><a href="/my_projects" class="waves-effect">My Projects</a></li>
      <li><a href="/scrollspy" class="waves-effect">All Projects</a></li>
      <li><%= link_to('Submit New Project', new_project_path, class: 'waves-effect') %></li>
    <% else %>
      <li><a href="/scrollspy" class="waves-effect">Projects</a></li>
    <% end %>

    <% if controller_name == 'projects' && action_name == 'show' %>
      <li><%= link_to 'Edit this project', edit_project_path(@project), class: 'waves-effect' %></li>
    <% end %>

    <ul class="collapsible collapsible-nav" data-collapsible="accordion">
      <li class="collapsible-nav-item">
        <div class="collapsible-header">Indexes</div>
        <div class="collapsible-body">
          <ul>
            <li><a href="/indexes/contributors" class="waves-effect">Contributors</a></li>
            <li><a href="/indexes/terms" class="waves-effect">Terms</a></li>
            <li><a href="/indexes/places" class="waves-effect">Places</a></li>
          </ul>
        </div>
      </li>
      <% unless Volume.official.empty? %>
      <li class="collapsible-nav-item">
        <div class="collapsible-header">Volume<%= 's' unless controller_name == 'volumes' %> <%= params[:volume] rescue '' %></div>
        <div class="collapsible-body">
          <ul>
            <% Volume.official.each do |volume| %>
              <li>
                <%= link_to volume.name, volume_path(volume.name), class: 'waves-effect' %>
              </li>
            <% end %>
          </ul>
        </div>
      </li>
      <% end %>
    </ul>
  
  </div>

  <% if controller_name == 'volumes' and action_name == 'index' %>
  <div id="scrollspy-nav">
    <ul class="section table-of-contents">
      <% @projects.each do |id, pages| %>
        <li><a href="#<%= id %>" data-turbolinks="false"><%= pages %></a></li>
      <% end %>
    </ul>
  </div>
  <% end %>
</ul>


<script type="text/javascript">

  $('.button-collapse').sideNav({
      // menuWidth: 300,
      edge: 'right',
      closeOnClick: true, 
      draggable: true
    }
  );

  // var nav = document.getElementById("nav");
  // var mouseoverTimeout;

 //  nav.addEventListener("mouseover", function( event ) {   
 //    mouseoverTimeout = setTimeout(function(){
 //     event.target.style.backgroundColor = "purple";
  //     console.log('purple!');
 //    }, 150)
 //  }, false);
  
 
 //  nav.addEventListener("mouseleave", function( event ) {   
 //   event.target.style.backgroundColor = "";
 //    clearTimeout(mouseoverTimeout)
 //  }, false);
  

</script>